<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.6 at 2015-03-07 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>core &#x2013; spBee - Core</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20150307" />
    <meta http-equiv="Content-Language" content="en" />
                                                    
<script src="//google-code-prettify.googlecode.com/svn/loader/run_prettify.js" type="text/javascript"></script>
                      
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                core
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 2015-03-07</span>
                  &nbsp;| <span id="projectVersion">Version: 1.0</span>
                      </div>
            <div class="xright">        
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>Overview</h5>
                  <ul>
                  <li class="none">
            <strong>Introduction</strong>
          </li>
          </ul>
                       <h5>Parent Project</h5>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="spBee">spBee</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                              <li class="expanded">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                    <ul>
                      <li class="none">
            <strong>About</strong>
          </li>
                      <li class="none">
                          <a href="dependencies.html" title="Dependencies">Dependencies</a>
            </li>
                      <li class="none">
                          <a href="dependency-info.html" title="Dependency Information">Dependency Information</a>
            </li>
                      <li class="none">
                          <a href="dependency-management.html" title="Dependency Management">Dependency Management</a>
            </li>
                      <li class="none">
                          <a href="license.html" title="Project License">Project License</a>
            </li>
                      <li class="none">
                          <a href="plugin-management.html" title="Plugin Management">Plugin Management</a>
            </li>
                      <li class="none">
                          <a href="team-list.html" title="Project Team">Project Team</a>
            </li>
                      <li class="none">
                          <a href="source-repository.html" title="Source Repository">Source Repository</a>
            </li>
                      <li class="none">
                          <a href="project-summary.html" title="Project Summary">Project Summary</a>
            </li>
              </ul>
        </li>
                                                                                                                                                                                                                    <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <h1>spBee - Core</h1>
<p>In the core module the Annotation Processor is defined and it&#x2019;s where the magic happens. The magic behind this is separated into two steps:</p>

<ul>
  
<li>collects all spBee annotations and data about the annotated Java code</li>
  
<li>generates the source code based on the gathered data</li>
</ul>
<div class="section">
<h2><a name="Collect_Data"></a>Collect Data</h2>
<p>The data is collected by the three classes in the <tt>at.rseiler.spbee.core.collector</tt> package.</p>
<div class="section">
<h3><a name="DtoCollector"></a>DtoCollector</h3>
<p>Collects the data of the annotated <tt>@Dto</tt> interfaces and classes.</p>

<ul>
  
<li>gets all methods annotated with <tt>@StoredProcedure</tt>
  
<ul>
    
<li>extracts the method name</li>
    
<li>extracts the return type</li>
    
<li>collects all parameters</li>
    
<li>collects all non spBee annotations</li>
    
<li>reads the <tt>@StoredProcedure</tt> annotation</li>
    
<li>reads the <tt>@RowMapper</tt> annotation</li>
    
<li>reads the <tt>@ReturnNull</tt> annotation</li>
    
<li>reads the <tt>@MappingConstructor</tt> annotation</li>
  </ul></li>
  
<li>with this data a DtoClass object is created</li>
</ul></div>
<div class="section">
<h3><a name="EntityClassCollector"></a>EntityClassCollector</h3>
<p>Collects the data of the annotated @Entity classes.</p>

<ul>
  
<li>collects the constructors annotated with @MappingConstructor. If no constructor is annotated with <tt>@MappingConstructor</tt> then the public constructor is used.
  
<ul>
    
<li>collects all parameters</li>
    
<li>reads the <tt>@MappingConstructor</tt> annotation</li>
  </ul></li>
  
<li>with this data a MapperClass object is created</li>
</ul></div>
<div class="section">
<h3><a name="ResultSetCollector"></a>ResultSetCollector</h3>
<p>Collects the data of the annotated <tt>@ResultSet</tt> classes.</p>

<ul>
  
<li>collects all class variables
  
<ul>
    
<li>reads the name and the type</li>
  </ul></li>
  
<li>
<p>with this data a ResultSetVariable object is created</p></div></div>
<div class="section">
<h2><a name="Generate_Code"></a>Generate Code</h2></li>
</ul>
<p>The code is generated by the three classes in the <tt>at.rseiler.spbee.core.generator</tt> package. The generators uses the <a class="externalLink" href="https://codemodel.java.net/">Codemodel</a> library to build the Java source code.</p>
<div class="section">
<h3><a name="DtoGenerator"></a>DtoGenerator</h3>
<p>Generates the code for the DTO classes. All collected non spBee annotations will be put on the corresponding methods.</p>
<p>The DTO methods have 5 flavors:</p>
<div class="section">
<h4><a name="The_return_type_is_a_list_of_entities"></a>The return type is a list of entities</h4>

<div class="source">

<div class="source">
<pre class="prettyprint lang-java">
public List&lt;Entity&gt; getUsers() {
    Object interceptorIdObject = SpInterceptor.before(&quot;sp_get_user&quot;); // optional
    List&lt;Entity&gt; list = ((List&lt;Entity&gt;) sp.execute().get(&quot;#result-set-0&quot;));
    SpInterceptor.after(interceptorIdObject, &quot;sp_get_user&quot;); // optional
    return list;
}
</pre></div>
</div></div>
<div class="section">
<h4><a name="The_return_type_is_an_entity"></a>The return type is an entity</h4>

<div class="source">

<div class="source">
<pre class="prettyprint lang-java">
public Entity getEntity(int id) {
    Object interceptorIdObject = SpInterceptor.before(&quot;sp_get_user&quot;); // optional
    List&lt;Entity&gt; list = ((List&lt;Entity&gt;) spGetUser.execute(id).get(&quot;#result-set-0&quot;));
    SpInterceptor.after(interceptorIdObject, &quot;sp_get_user&quot;); // optional

    if (list.size() == 1) {
        return list.get(0);
    } else {
        if (list.size() == 0) {
            throw new ObjectDoesNotExist();
        } else {
            throw new MultipleObjectsReturned();
        }
    }
}
</pre></div>
</div></div>
<div class="section">
<h4><a name="The_return_type_is_an_optional_type_of_an_entity"></a>The return type is an optional type of an entity</h4>

<div class="source">

<div class="source">
<pre class="prettyprint lang-java">
public Optional&lt;Entity&gt; getOptionalEntity(int id) {
    Object interceptorIdObject = SpInterceptor.before(&quot;sp_get_user&quot;); // optional
    List&lt;Entity&gt; list = ((List&lt;Entity&gt; ) spGetUser.execute(id).get(&quot;#result-set-0&quot;));
    SpInterceptor.after(interceptorIdObject, &quot;sp_get_user&quot;); // optional

    if (list.size() == 1) {
        return Optional.of(list.get(0));
    } else {
        if (list.size() == 0) {
            return Optional.empty();
        } else {
            throw new MultipleObjectsReturned();
        }
    }
}
</pre></div>
</div></div>
<div class="section">
<h4><a name="The_return_type_is_an_entity_and_the_method_is_annotated_with_ReturnNull"></a>The return type is an entity and the method is annotated with @ReturnNull</h4>

<div class="source">

<div class="source">
<pre class="prettyprint lang-java">
public Entity getEntityOrNull(int id) {
    Object interceptorIdObject = SpInterceptor.before(&quot;sp_get_user&quot;); // optional
    List&lt;Entity&gt; list = ((List&lt;Entity&gt;) spGetUser.execute(id).get(&quot;#result-set-0&quot;));
    SpInterceptor.after(interceptorIdObject, &quot;sp_get_user&quot;); // optional

    if (list.size() == 1) {
        return list.get(0);
    } else {
        if (list.size() == 0) {
            return null;
        } else {
            throw new MultipleObjectsReturned();
        }
    }
}
</pre></div>
</div></div>
<div class="section">
<h4><a name="The_return_type_is_a_ResultSet"></a>The return type is a ResultSet</h4>

<div class="source">

<div class="source">
<pre class="prettyprint lang-java">
public UserPermissionsResultSet getUserWithPermissions(int id) {
    Object interceptorIdObject = SpInterceptor.before(&quot;sp_get_user&quot;); // optional
    Map&lt;String, Object&gt; map = spGetUserWithPermissions.execute(id);
    SpInterceptor.after(interceptorIdObject, &quot;sp_get_user&quot;); // optional
    List&lt;Entity&gt; list0 = ((List&lt;Entity&gt; ) map.get(&quot;#result-set-0&quot;));
    Optional obj0;

    if (list0.size() == 1) {
        obj0 = Optional.of(list0.get(0));
    } else {
        if (list0.size() == 0) {
            obj0 = Optional.empty();
        } else {
            throw new MultipleObjectsReturned();
        }
    }

    List&lt;Permission&gt; list1 = ((List&lt;Permission&gt;) map.get(&quot;#result-set-1&quot;));
    return new UserPermissionsResultSet(obj0, list1);
}
</pre></div>
</div></div></div>
<div class="section">
<h3><a name="MapperGenerator"></a>MapperGenerator</h3>
<p>Generates the code for the MapperClasses. The Entity&#x2019;s constructor must only have basic parameters. It&#x2019;s not possible to use other entities in the constructor. If a more complex mapping is required then write an own MapperClass and use the @RowMapper annotation.</p>

<div class="source">

<div class="source">
<pre class="prettyprint lang-java">
public class EntityMapper implements RowMapper&lt;Entity&gt; {

     public Entity mapRow(ResultSet rs, int rowNum) throws SQLException {
         return new Entity(rs.*(1), rs.*(2));
     }

}
</pre></div>
</div></div>
<div class="section">
<h3><a name="StoredProcedureGenerator"></a>StoredProcedureGenerator</h3>
<p>Generates the code for the StoredProcedure classes.</p>
<div class="section">
<h4><a name="Single_result_set"></a>Single result set</h4>

<div class="source">

<div class="source">
<pre class="prettyprint lang-java">
public class SpGetEntity extends StoredProcedure {

    public SpGetEntity(DataSource dataSource) {
        super(dataSource, &quot;sp_get_entity&quot;);
        declareParameter(new SqlParameter(&quot;id&quot;, Types.INTEGER));
        declareParameter(new SqlReturnResultSet(&quot;#result-set-0&quot;, new EntityDefaultMapper()));
        compile();
    }

    public Map&lt;String, Object&gt; execute(int id) {
        return super.execute(id);
    }

}
</pre></div>
</div></div>
<div class="section">
<h4><a name="Multiple_result_sets"></a>Multiple result sets</h4>

<div class="source">

<div class="source">
<pre class="prettyprint lang-java">
public class SpGetEntity extends StoredProcedure {

    public SpGetEntity(DataSource dataSource) {
        super(dataSource, &quot;sp_get_entity&quot;);
        declareParameter(new SqlParameter(&quot;id&quot;, Types.INTEGER));
        declareParameter(new SqlReturnResultSet(&quot;#result-set-0&quot;, new Entity1DefaultMapper()));
        declareParameter(new SqlReturnResultSet(&quot;#result-set-1&quot;, new Entity2DefaultMapper()));
        compile();
    }

    public Map&lt;String, Object&gt; execute(int id) {
        return super.execute(id);
    }

}
</pre></div>
</div></div></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                   2015.
          All rights reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>